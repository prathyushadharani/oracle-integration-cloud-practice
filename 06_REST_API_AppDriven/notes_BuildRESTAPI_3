REST Integration -part3
we created REST API, Also configured trigger connection
we created mapper as well-receiving first name as input, prefixing hello 
and sending back response

now the next step is
we need to activate the rest api and test it


right now integration is in draft status
when integration is in draft status we will not see activate option when you click on 3 dots

when will we see option to activate integration?
by default integration will be in draft status
and after we enable tracking on the integration,
integration status changes to configured,
then we can go ahead and activate integration

so get into the API,
so after we get into Integration->how do we enable tracking?
we cick on business identifiers (I) option->
from here we will have option to enable tracking identifiers

remember ->on a rest API we can have upto 3 tracking identifiers
and you need to have atleast 1-which is a primary tracking identifier

now what is the exact usage of this identifier?

now lets go to (I) Business Identifiers
primary business identifiers
variable undefined 
(x) business identifier field
choose firstName from input sources->sources->execute->TemplateParameters->firstName
drag this source on to business identifier field: this field should be updated by drag and drop from source tree
business identifier variable
tracking_var_1(default)
this field changes to firstName

the moment you add firstName as tracking identifier
tracking_var_1=firstName
is shown in variable undefined position

now once you click save->the status of the integration changes from draft to configured

Draft         ->      Configured       ->      Active
        Enable Tracking           Activate


 now when you click on 3 dots beside the integration now it shows an option to activate
when you click on activate you see
activate integration window popup from right
for UG86 Hello Word REST API (1.0)

it has below 3 options: rb(radio button)
select tracing level
rb Production
rb Audit
rb Debug (Not recommended)
(debug has a warning that says->additionally, all payloads and all activities inside loops(upto 1000 iterations) are shown in the 
activity stream and this data is retained for a period of 24 hours. it may slowdown your system and also pose a security risk
as sensitive information from payload will be logged.)

configure runtime options
checkbox allow to run again
when you run again an integration,it creates a new instance and rund againa ny transactions

checkbox enable payload validation

now lets not explore anything else but only enable trace level as debug and activate the integration

after clicking on activate and going back to integration and clickling on 3 dots->we see run option

you will see configure and run screen

you will see method name: GET
URI path (ic/api/integration..../{firstName}

Request
URI parameters
already checkedbox firstName textbox

Response
status: instance ID:
Body Headers
1

we also have 2 buttons on right corner : endpoint metadata and track instances
--------------------
now what do we get to see?

when you click on endpoint metadata
pop up from right shows:
metadata swagger openapi
in metadata
endpoint description
endpoint URL
https://unogeeksprodoic-...../UG86/UG86_HELLO_WORLD_REST_API/1.0/sayHello/{firstName}
(client will trigger our api using this url)
swagger
https://unogeeksprodoic-...../UG86/UG86_HELLO_WORLD_REST_API/1.0/metadata/swagger
openapi
https://unogeeksprodoic-...../UG86/UG86_HELLO_WORLD_REST_API/1.0/metadata/openapi
urls are shown

resource/sayHello{firstName}
method GET
Response
Response media type: application/json
Response sample
{"Greeting":"Hello ABC"}


all the above things are shown on screen


but can we just share url with client? no we should first do unit test and then confirm its working fine then ask 3rd party to call our integration

now add value of firstname it gets displayed in the URL also

URI path (ic/api/integration..../sayHello/unogeeks1111

Request
URI parameters
already checkedbox firstName unogeeks1111

go ahead and click run

Response
status: 200 OK instance ID:22 char string (aC1hB63yEe-COaUkO-YGCQ)
Body Headers
1 {
"Greeting" : "Hello unogeeks1111"
}

Activity stream pops up when you click run:
 we see payload response and complete instance activity

now we are in test phase , can we see these intances anywhere else in OIC? yes

go to OIC console->Observability->Instances->here you see instances

you can filter number of instance syou can see based on 24 hours or 1 hour ->many instances will be present
it will be difficult for us to track our intgeration instance

how do we track it then?
on what basis?
with the help of tracking identifiers

primary identifier instance id status business identifiers duration
firstName:unogeeks aC1hB63yEe-COaUkO-YGCQ succeeded               received 6 mins ago
link to see integration code (just below primary identifier)
to look what happened in integration during runtime clcik on primary identifier
we can see activity stream and green path
wecan search for instances with primary or secondary tracking identifiers

now since integration is working share the url with client

we can use postman->mimic as if client is invoking  rest apifrom another application

test from postman->replace firstName with value->test ->fail(401 unauthorized)->authentication failure

now how do you know which auth to use?
when ever you call integration in oic how do you know in what format you pass authentication details?
go to integration->in integration there is trigger connection->which has security policy-> this will determine
how you pass authentication

OAuth 2.0
basic auth
OAuth 2.0 or basic auth

say lets choose basic auth

test coonnection->for this change to take effect in oic->save->save and reactivate
integration will be saved->deactivated and gets reactivated again

now go back to postman pass basic authentication-> oic username and password
ugoic.user1
and its password

we enter these on authorization tab in postman for that url

click send on postman

now we get response
{
"Greeting":"Hello Sachin"
}

when we do unit test integration we can see instance id's
but we dont see instance id's in postman

now say there are 200 requests one failed and now how do client track the instance? 
they give us firstname and we using tracking identifier should go and search in oic with firstname provided by client

now what the problem?
we are sharing oic instance link
oic username
oic password with client

now the client can act smart and login to oic
this is why we should never ever be using basic auth

unless we dont have a choice
when client /3rd paty would say open authorization-(oauth) is not allowed or 
they dont have capability to generate oauth tokens

in such cases we dont have choice but use basic auth(25:50 mins done)

now what to do? login to OCI

what we did in day 5 session? we did 3 things.
1. went into identity and security->created users and oic instance
2. went into oracle cloud services->search unogeeks prod oic instance within oic instance
assign roles to oic users
set service admin role->give name
user role->developer

now if you share ugoic.user1 user login details who is assigned as developer entire content of oic stands exposed


so now create a user and assign the user to service invoker role
serviceInvoker:
that user with serviceInvoker role is what i would share with 3rd party

so if a person with a serviceInvoker role logs into oic instance what would he see?
he doesnt get to see anything at all
search oic roles in google->what users can do in the navigation pane by role->this table tells you what each role can see in oic

so these cred created here can only be used for invoke

so basic auth is not recommended at all but if client says no choice then we give cred to user with service invoker rule assigned

always prefer OAuth token

benefit: no need to share username and password with 3rd party

lets change auth to OAuth 2.0 save &reactivate

but lets pass auth as basic auth from postman
doesnt work (401 unauthorized) error
(32 mins done)

this is bcoz of mismatch even if it is valid username and password

lets see how oauth works.
in materials we have 1.0.1.OAuth in OIC.docx
for oic instance we created users
we added users to roles within oic instance

there is IDCS attached to OIC

but for OAuth we go to IDCS->instead of registering user->we register a client or apllication in OCI
now we have client ID and secret generated


now we share these with client
all these will be done by admin

now client application will hit IDCS (identity cloud service) token endpoint url and pass ID and secret as input->
instead of username and password
->token will validate if valid client
if yes->token endpoint url will throw a token back->thats the oauth token

and now that token is what the client application would use to call the rest api in oic
-------

let see how this is implemented

1.how do we register client in IDCS
go to integrated applications->add application->select confidential application->click lauch workflow

2.Add Confidential Application:
Add application details:
name: UG86-OAuth-App
dont need to enter anything else just go to next screen

3. we have 2 options
resource server configuration
client configuration->select this

in authorization: enable client crdentials and resource owner options->check the checkboxes

the moment you enable client credentials->there would be a client ID and client secret that would be generated

when we scroll down
after we hit endpoint we get a token->with that token->
what resources in OCI would you be able to access? not OIC.
that would be controlled by what you mention in authorized resources section when you scroll down ->
this is under token issuance policy

we have 2 radio buttons
1. all
2. specific

say we selected specific

check ->add resources
click on add scope->
a search box appears->search for production OIC instance here->check it
click add

there will be 2 entries->2 scopes added

now say we want our client to trigger only the rest OIC instances in prod not in dev or any other env

go to next screen->nthg to enter here
default selected skip and do later->finish

now step 1 of getting client ID and secret is completed
------------------------------------------------------
lets go to step 2

hitting token endpoint url by passing client ID and secret, so we get an OAuth token

q1-? where do I get token endpoint URL from?
now if we go back into Identity Domain Cloud Service->Domains->default

remember in OCI there is a default domain called dafault
click on default->there you will see domain URL with show/copy options
copy and paste it

in that domain endpoint url we will have 443 as the port
but since its https connection it will always be 443

https://idcs-f1275........identity.oraclecloud.com:443

now remove 443

to the endpoint url we need to pass in a suffix
https://idcs-f1275........identity.oraclecloud.com/oauth2/v1/token

this is teh token endpoint url that i need to call by passing client id and client secret

now its a POST call that we need to do

from a rest api we can do a post call to that endpoint url

in postman->create a new request
select post from dropdown
in authorization details select basic auth
now pass client id and client secret in username and password

in the body we need to pass a couple of parameters
we need to pass

grant type-client_credentials (tells that its not actual username/password 
we are passing but its client id and client secret)
and 
scope (if we go to production oic instance->go to OAuth->
we will be able to see primary audience

and to that primary audience
we need to copy the first scope that we see under scopes section

so scope=primary audience+scope->this is the full scope that we need to use

now when we hit the service we get access token in response->thats the oauth token 
that we need to pass
when we call the rest api

step 3: call rest api using this token



























